CREATE DATABASE SALES_MANAGEMENT
GO

USE SALES_MANAGEMENT
GO

CREATE TABLE NHANVIEN
(
	MANV VARCHAR(20) NOT NULL,
	PASSWORD VARCHAR(100) NOT NULL,
	TEN NVARCHAR(50),
	NGAYSINH SMALLDATETIME,
	GIOITINH NVARCHAR(10),
	SDT VARCHAR(20),
	DIACHI NVARCHAR(100),
	CONSTRAINT PK_NHANVIEN PRIMARY KEY (MANV)
)
GO

CREATE TABLE QUANLY
(
	MAQL VARCHAR(20) NOT NULL,
	PASSWORD VARCHAR(100) NOT NULL,
	TEN NVARCHAR(50),
	NGAYSINH SMALLDATETIME,
	GIOITINH NVARCHAR(10),
	SDT VARCHAR(20),
	DIACHI NVARCHAR(100),
	CONSTRAINT PK_QUANLY PRIMARY KEY (MAQL),
)
GO

CREATE TABLE KHACHHANG
(
	MAKH VARCHAR(20) NOT NULL,
	TEN NVARCHAR(50),
	NGAYSINH SMALLDATETIME,
	GIOITINH NVARCHAR(10),
	SDT VARCHAR(20),
	DIACHI NVARCHAR(100),
	DIEM INT,
	CONSTRAINT PK_KHACHHANG PRIMARY KEY (MAKH),
)
GO

CREATE TABLE SANPHAM
(
	MASP VARCHAR(20) NOT NULL,
	TEN NVARCHAR(100),
	SOLUONG INT,
	DVT NVARCHAR(50),
	GIANHAP INT,
	GIABANLE INT,
	HSD SMALLDATETIME,
	NHACUNGCAP NVARCHAR(100),
	GHICHU NVARCHAR(100),
	CONSTRAINT PK_SANPHAM PRIMARY KEY (MASP)
)
GO

CREATE TABLE HOADON
(
	MAHD VARCHAR(20) NOT NULL,
	MANV VARCHAR(20) NOT NULL,
	MAKH VARCHAR(20),
	THOIGIAN SMALLDATETIME,
	TONGGIATRI INT,
	CONSTRAINT PK_HOADON PRIMARY KEY (MAHD)
)
GO

CREATE TABLE CTHD
(
	MAHD VARCHAR(20) NOT NULL,
	MASP VARCHAR(20) NOT NULL,
	SOLUONG INT,
	CONSTRAINT PK_CTHD PRIMARY KEY (MAHD, MASP)
)
GO

ALTER TABLE HOADON
ADD CONSTRAINT FK_HOADON_NHANVIEN_MANV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
GO

ALTER TABLE HOADON
ADD CONSTRAINT FK_HOADON_KHACHHANG_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)
GO

ALTER TABLE CTHD
ADD CONSTRAINT FK_CTHD_HOADON_MAHD FOREIGN KEY (MAHD) REFERENCES HOADON(MAHD)
GO

ALTER TABLE CTHD
ADD CONSTRAINT FK_CTHD_SANPHAM_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP)
GO

/*
ALTER TABLE SANPHAM
ADD GHICHU NVARCHAR(100)

ALTER TABLE NHANVIEN
ALTER COLUMN TEN NVARCHAR(50)
ALTER TABLE QUANLY
ALTER COLUMN TEN NVARCHAR(50)
ALTER TABLE KHACHHANG
ALTER COLUMN TEN NVARCHAR(50)
ALTER TABLE SANPHAM
ALTER COLUMN TEN NVARCHAR(50)

ALTER TABLE NHANVIEN
ALTER COLUMN DIACHI NVARCHAR(100)
ALTER TABLE QUANLY
ALTER COLUMN DIACHI NVARCHAR(100)
ALTER TABLE KHACHHANG
ALTER COLUMN DIACHI NVARCHAR(100)

ALTER TABLE NHANVIEN
ALTER COLUMN GIOITINH NVARCHAR(10)
ALTER TABLE QUANLY
ALTER COLUMN GIOITINH NVARCHAR(10)
ALTER TABLE KHACHHANG
ALTER COLUMN GIOITINH NVARCHAR(10)

ALTER TABLE SANPHAM
ALTER COLUMN NHACUNGCAP NVARCHAR(100)
ALTER TABLE SANPHAM
ALTER COLUMN DVT NVARCHAR(50)
*/

set dateformat dmy
-- SANPHAM
INSERT INTO SANPHAM VALUES ('3694362852260',N'Coca Cola 330ml',43,N'Lon',8000,10000,'25/08/2021',N'Coca-Cola',N'')
INSERT INTO SANPHAM VALUES ('6175747286674',N'7Up 330ml/Lon',48,N'Lon',8000,10000,'12/05/2021',N'Pepsi',N'')
INSERT INTO SANPHAM VALUES ('8738772500405',N'Pepsi 330ml/Lon',46,N'Lon',8000,10000,'09/06/2021',N'Pepsi',N'')
INSERT INTO SANPHAM VALUES ('9709955748951',N'Bánh Chocopie',12,N'Hộp',43000,48000,'14/07/2021',N'Orion Vina',N'')
INSERT INTO SANPHAM VALUES ('7903887909141',N'Mỳ Hảo Hảo Tôm chua cay',36,N'Gói',2500,3000,'03/05/2021',N'ACECOOK',N'')
INSERT INTO SANPHAM VALUES ('9303914296905',N'Mỳ Omachi Xốt bò hầm',28,N'Gói',5500,6000,'17/08/2021',N'Masan',N'')
INSERT INTO SANPHAM VALUES ('6429981858495',N'Bánh AFC Vị lúa mì 200g',6,N'Hộp',24000,27000,'22/05/2021',N'Kinh Đô',N'')
INSERT INTO SANPHAM VALUES ('9798371282668',N'Sữa Milo 180ml',32,N'Hộp',6000,7000,'18/05/2021',N'MILO',N'')
INSERT INTO SANPHAM VALUES ('7795105401069',N'Cà phê NESCAFE ESPRESSODA 330ml',14,N'Lon',10000,12000,'27/07/2021',N'NESCAFE',N'')
INSERT INTO SANPHAM VALUES ('3925444825477',N'Sữa đậu nành Fami 200ml',24,N'Bịch',3500,4000,'29/03/2021',N'Vinasoy',N'')

-- NHANVIEN
INSERT INTO NHANVIEN VALUES ('NV001','161217381747022820119720656236237850238247',N'Nguyễn Văn An','01/01/2001',N'Nam','0935735816',N'Thủ Đức, TPHCM')
INSERT INTO NHANVIEN VALUES ('NV002','2282422021244143248137221361901441482301237',N'Trần Trung Hiếu','10/10/2000',N'Nam','0914758372',N'Bình Thạnh, TPHCM')
INSERT INTO NHANVIEN VALUES ('NV003','36861675317221110947128204921723013142242',N'Trần Như Phương','21/08/1998',N'Nữ','0924587183',N'Dĩ An, Bình Dương')

-- QUANLY
INSERT INTO QUANLY VALUES ('QL001','13541541422814327128216551122161791976217',N'Vũ Minh Lộc','16/03/1992',N'Nam','0912517683',N'Thủ Đức, TPHCM')

-- KHACHHANG
INSERT INTO KHACHHANG VALUES ('KH001',N'Trần Thanh','01/01/1990',N'Nam','0915387624',N'Thủ Đức, TPHCM',145)
INSERT INTO KHACHHANG VALUES ('KH002',N'Lê Trung Hậu','05/04/1983',N'Nam','0925743651',N'Bình Thạnh, TPHCM',82)
INSERT INTO KHACHHANG VALUES ('KH003',N'Nguyễn Thu Trang','25/07/1997',N'Nữ','0913582486',N'Dĩ An, Bình Dương',117)

-- HOADON
INSERT INTO HOADON VALUES ('20SEP0001', 'NV001', 'KH001', '03/09/2020', 144000)
INSERT INTO HOADON VALUES ('20OCT0001', 'NV002', 'KH002', '05/10/2020', 98000)
INSERT INTO HOADON VALUES ('20OCT0002', 'NV001', 'KH003', '14/10/2020', 80000)
INSERT INTO HOADON VALUES ('20NOV0001', 'NV003', 'KH001', '07/11/2020', 93000)
INSERT INTO HOADON VALUES ('20NOV0002', 'NV003', 'KH002', '18/11/2020', 80000)

-- CTHD
INSERT INTO CTHD VALUES ('20SEP0001', '3694362852260', 4)
INSERT INTO CTHD VALUES ('20SEP0001', '8738772500405', 5)
INSERT INTO CTHD VALUES ('20SEP0001', '6429981858495', 2)
INSERT INTO CTHD VALUES ('20OCT0001', '7795105401069', 3)
INSERT INTO CTHD VALUES ('20OCT0001', '9709955748951', 1)
INSERT INTO CTHD VALUES ('20OCT0001', '9798371282668', 2)
INSERT INTO CTHD VALUES ('20OCT0002', '3925444825477', 5)
INSERT INTO CTHD VALUES ('20OCT0002', '6175747286674', 3)
INSERT INTO CTHD VALUES ('20OCT0002', '9303914296905', 5)
INSERT INTO CTHD VALUES ('20NOV0001', '7903887909141', 5)
INSERT INTO CTHD VALUES ('20NOV0001', '9798371282668', 3)
INSERT INTO CTHD VALUES ('20NOV0001', '6429981858495', 1)
INSERT INTO CTHD VALUES ('20NOV0001', '3694362852260', 3)
INSERT INTO CTHD VALUES ('20NOV0002', '8738772500405', 3)
INSERT INTO CTHD VALUES ('20NOV0002', '9303914296905', 5)
INSERT INTO CTHD VALUES ('20NOV0002', '6175747286674', 2)


SELECT * FROM SANPHAM
SELECT * FROM HOADON ORDER BY THOIGIAN DESC
SELECT * FROM CTHD
SELECT * FROM KHACHHANG
SELECT * FROM NHANVIEN



SELECT * FROM HOADON WHERE THOIGIAN >= '01/11/2020' AND THOIGIAN <= '30/11/2020' ORDER BY MAHD DESC
SELECT SANPHAM.MASP, TEN, A.SOLUONG, DVT, GIABANLE FROM SANPHAM INNER JOIN 
	(SELECT * FROM CTHD WHERE CTHD.MAHD = '20NOV0003') AS A
ON SANPHAM.MASP = A.MASP

SELECT * FROM NHANVIEN

SELECT MAHD FROM HOADON WHERE THOIGIAN IN (SELECT MAX(THOIGIAN) FROM HOADON)
SELECT * FROM HOADON WHERE THOIGIAN IN (SELECT MAX(THOIGIAN) FROM HOADON)

ALTER TABLE HOADON
ADD TONGGIATRI INT

ALTER TABLE CTHD
DROP COLUMN DONGIA
-- cập nhật vào máy phước ngày 19/12
CREATE FUNCTION [dbo].[fuConvertToUnsign1] ( @strInput NVARCHAR(4000) ) RETURNS NVARCHAR(4000) AS BEGIN IF @strInput IS NULL RETURN @strInput IF @strInput = '' RETURN @strInput DECLARE @RT NVARCHAR(4000) DECLARE @SIGN_CHARS NCHAR(136) DECLARE @UNSIGN_CHARS NCHAR (136) SET @SIGN_CHARS = N'ăâđêôơưàảãạáằẳẵặắầẩẫậấèẻẽẹéềểễệế ìỉĩịíòỏõọóồổỗộốờởỡợớùủũụúừửữựứỳỷỹỵý ĂÂĐÊÔƠƯÀẢÃẠÁẰẲẴẶẮẦẨẪẬẤÈẺẼẸÉỀỂỄỆẾÌỈĨỊÍ ÒỎÕỌÓỒỔỖỘỐỜỞỠỢỚÙỦŨỤÚỪỬỮỰỨỲỶỸỴÝ' +NCHAR(272)+ NCHAR(208) SET @UNSIGN_CHARS = N'aadeoouaaaaaaaaaaaaaaaeeeeeeeeee iiiiiooooooooooooooouuuuuuuuuuyyyyy AADEOOUAAAAAAAAAAAAAAAEEEEEEEEEEIIIII OOOOOOOOOOOOOOOUUUUUUUUUUYYYYYDD' DECLARE @COUNTER int DECLARE @COUNTER1 int SET @COUNTER = 1 WHILE (@COUNTER <=LEN(@strInput)) BEGIN SET @COUNTER1 = 1 WHILE (@COUNTER1 <=LEN(@SIGN_CHARS)+1) BEGIN IF UNICODE(SUBSTRING(@SIGN_CHARS, @COUNTER1,1)) = UNICODE(SUBSTRING(@strInput,@COUNTER ,1) ) BEGIN IF @COUNTER=1 SET @strInput = SUBSTRING(@UNSIGN_CHARS, @COUNTER1,1) + SUBSTRING(@strInput, @COUNTER+1,LEN(@strInput)-1) ELSE SET @strInput = SUBSTRING(@strInput, 1, @COUNTER-1) +SUBSTRING(@UNSIGN_CHARS, @COUNTER1,1) + SUBSTRING(@strInput, @COUNTER+1,LEN(@strInput)- @COUNTER) BREAK END SET @COUNTER1 = @COUNTER1 +1 END SET @COUNTER = @COUNTER +1 END SET @strInput = replace(@strInput,' ','-') RETURN @strInput END

select * from nhanvien
